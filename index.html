

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BlueWrite</title>
  <style>
    :root{--bg:#0f1724;--panel:#0b1220;--muted:#94a3b8;--accent:#60a5fa}
    html,body{height:100%;margin:0;font-family:Inter,Roboto,system-ui,Arial;background:linear-gradient(180deg,#071028 0%, #081028 100%);color:#e6eef8}
    .app{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:14px;height:100%;box-sizing:border-box}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px;padding:12px;display:flex;flex-direction:column;min-height:0}
    .toolbar{display:flex;gap:8px;margin-bottom:8px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:6px 8px;border-radius:8px;cursor:pointer}
    button.active{border-color:var(--accent);color:var(--accent)}
    .editor{flex:1;display:flex;min-height:0}
    textarea{flex:1;background:transparent;border:none;color:#e6eef8;outline:none;padding:12px;font-size:14px;resize:none;line-height:1.5}
    .preview{flex:1;overflow:auto;padding:12px;background:transparent;border-left:1px dashed rgba(255,255,255,0.02)}
    .status{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:13px;color:var(--muted)}
    pre code{display:block;padding:8px;border-radius:6px;font-family:Source Code Pro, monospace;font-size:13px;overflow:auto}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    input[type=search]{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    @media (max-width:900px){.app{grid-template-columns:1fr;grid-auto-rows:1fr}}
  </style>
  <!-- External libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body>
  <div class="app">
    <div class="panel">
      <div class="topbar">
        <div style="display:flex;flex-direction:column">
          <strong>Markdown Editor</strong>
          <span class="small">Live preview â€¢ Autosave â€¢ Paste images</span>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="search" type="search" placeholder="Search...">
          <button id="exportMd">Export .md</button>
          <button id="copyHtml">Copy HTML</button>
          <button id="clearBtn">Clear</button>
        </div>
      </div>

      <div class="toolbar" role="toolbar" aria-label="Markdown toolbar">
        <button data-action="bold" title="Bold (Ctrl/Cmd-B)"><strong>B</strong></button>
        <button data-action="italic" title="Italic (Ctrl/Cmd-I)"><em>I</em></button>
        <button data-action="h1" title="Heading 1">H1</button>
        <button data-action="h2" title="Heading 2">H2</button>
        <button data-action="ul" title="Bullet list">â€¢ List</button>
        <button data-action="ol" title="Numbered list">1. List</button>
        <button data-action="code" title="Inline code or block (Ctrl/Cmd-K)"><code>{ }</code></button>
        <button data-action="link" title="Insert link">ðŸ”—</button>
      </div>

      <div class="editor" aria-label="Markdown editing area">
        <textarea id="md" placeholder="# Start writing markdown..." spellcheck="false"></textarea>
      </div>

      <div class="status">
        <div id="autosave" class="small">Autosave: off</div>
        <div class="small">Lines: <span id="lines">0</span></div>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Preview</strong>
        <div class="small">Rendered HTML (updates live)</div>
      </div>
      <div id="preview" class="preview"></div>
    </div>
  </div>

  <script>
    // Config
    const STORAGE_KEY = 'simple_markdown_content_v1';
    const editor = document.getElementById('md');
    const preview = document.getElementById('preview');
    const autosaveIndicator = document.getElementById('autosave');
    const linesCounter = document.getElementById('lines');

    // Initialize marked
    marked.setOptions({
      breaks: true,
      highlight: function(code, lang) {
        try{
          return hljs.highlightAuto(code, lang ? [lang] : undefined).value;
        } catch (e) { return hljs.highlightAuto(code).value; }
      }
    });

    // Load from localStorage
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) { editor.value = saved; }

    function render(){
      const md = editor.value;
      preview.innerHTML = marked.parse(md || '');
      // run highlight on code blocks
      preview.querySelectorAll('pre code').forEach((block)=>{hljs.highlightElement(block)});
      linesCounter.textContent = md.split('\n').length;
    }

    // Initial render
    render();

    // Debounced update
    let debounceTimer = null;
    editor.addEventListener('input', ()=>{
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(()=>{ render(); }, 150);
      // autosave
      localStorage.setItem(STORAGE_KEY, editor.value);
      autosaveIndicator.textContent = 'Autosave: saved';
      setTimeout(()=>autosaveIndicator.textContent = 'Autosave: on', 800);
    });

    // Toolbar actions
    document.querySelectorAll('[data-action]').forEach(btn=>{
      btn.addEventListener('click', ()=>applyAction(btn.dataset.action));
    });

    function getSelectionRange(el){ return [el.selectionStart, el.selectionEnd]; }
    function replaceRange(el, start, end, insert){
      const val = el.value;
      el.value = val.slice(0,start) + insert + val.slice(end);
      el.focus();
      const cursor = start + insert.length;
      el.setSelectionRange(cursor,cursor);
      render();
    }

    function applyAction(action){
      const [s,e] = getSelectionRange(editor);
      const selected = editor.value.slice(s,e) || '';
      switch(action){
        case 'bold': replaceRange(editor,s,e, `**${selected||'bold text'}**`); break;
        case 'italic': replaceRange(editor,s,e, `*${selected||'italic text'}*`); break;
        case 'h1': replaceRange(editor,s,e, `# ${selected||'Heading 1'}\n`); break;
        case 'h2': replaceRange(editor,s,e, `## ${selected||'Heading 2'}\n`); break;
        case 'ul': replaceRange(editor,s,e, (selected||'List item').split('\n').map(l=>`- ${l}`).join('\n')); break;
        case 'ol': replaceRange(editor,s,e, (selected||'List item').split('\n').map((l,i)=>`${i+1}. ${l}`).join('\n')); break;
        case 'code':
          if(selected.includes('\n')) replaceRange(editor,s,e, `\n\`\`\`\n${selected}\n\`\`\`\n`);
          else replaceRange(editor,s,e, `\`${selected||'code'}\``);
          break;
        case 'link':
          const url = prompt('URL','https://');
          if(url) replaceRange(editor,s,e, `[${selected||'link text'}](${url})`);
          break;
      }
    }

    // Keyboard shortcuts
    window.addEventListener('keydown', (ev)=>{
      const cmd = ev.ctrlKey || ev.metaKey;
      if(!cmd) return;
      if(ev.key.toLowerCase()==='b'){ ev.preventDefault(); applyAction('bold'); }
      if(ev.key.toLowerCase()==='i'){ ev.preventDefault(); applyAction('italic'); }
      if(ev.key.toLowerCase()==='k'){ ev.preventDefault(); applyAction('code'); }
    });

    // Export .md
    document.getElementById('exportMd').addEventListener('click', ()=>{
      const blob = new Blob([editor.value], {type:'text/markdown'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'note.md'; a.click(); URL.revokeObjectURL(url);
    });

    // Copy rendered HTML
    document.getElementById('copyHtml').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(preview.innerHTML); alert('HTML copied to clipboard'); }
      catch(e){ alert('Unable to copy: ' + e.message); }
    });

    // Clear
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      if(confirm('Clear editor and local storage?')){ editor.value=''; localStorage.removeItem(STORAGE_KEY); render(); }
    });

    // Search in editor (simple)
    document.getElementById('search').addEventListener('input',(e)=>{
      const q = e.target.value.trim();
      if(!q) return; // leave it simple
      const idx = editor.value.indexOf(q);
      if(idx>=0){ editor.focus(); editor.setSelectionRange(idx, idx+q.length); editor.scrollTop = editor.scrollHeight * (idx / Math.max(1, editor.value.length)); }
    });

    // Handle paste of images: convert image clipboard items to data URLs and insert as markdown image
    editor.addEventListener('paste', async (ev)=>{
      const items = ev.clipboardData && ev.clipboardData.items;
      if(!items) return;
      for(const it of items){
        if(it.type.indexOf('image')!==-1){
          ev.preventDefault();
          const file = it.getAsFile();
          const reader = new FileReader();
          reader.onload = ()=>{ const data = reader.result; const [s,e]=getSelectionRange(editor); replaceRange(editor,s,e, `![pasted image](${data})`); }
          reader.readAsDataURL(file);
        }
      }
    });

    // Accessibility: set role and labels
    editor.setAttribute('aria-label','Markdown editor textarea');
    preview.setAttribute('aria-live','polite');
  </script>
</body>
</html>
